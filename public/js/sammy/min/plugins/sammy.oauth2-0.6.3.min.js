// -- Sammy.js -- /plugins/sammy.oauth2.js
// http://sammyjs.org
// Version: 0.6.3
// Built: 2011-01-27 10:31:09 -0800
(function(a){Sammy=Sammy||{};Sammy.OAuth2=function(d){d.use("JSON");this.authorize="/oauth/authorize";this.helper("requireOAuth",function(e){if(this.app.getAccessToken()){if(e){e.apply(this)}}else{this.redirect(this.app.authorize+"?state="+escape(this.path));return false}});this.helper("loseAccessToken",function(){this.app.loseAccessToken()});this.requireOAuth=function(e){this.before(e||{},function(f){return f.requireOAuth()})};this.getAccessToken=function(){return this.session("oauth.token")};this.setAccessToken=function(e){this.session("oauth.token",e);this.trigger("oauth.connected")};this.loseAccessToken=function(){this.session("oauth.token",null);this.trigger("oauth.disconnected")};a(document).ajaxSend(function(e,g){var f=d.getAccessToken();if(f){g.setRequestHeader("Authorization","OAuth "+f)}});function c(g){var f=g.substring(1).split("&"),h={};for(var e in f){var j=f[e].split("=");h[j[0]]=j[1].replace(/\+/g," ")}return h}var b;this.bind("run",function(e,f){b=f.start_url||"#";if(this.app.getAccessToken()){this.trigger("oauth.connected")}});this.before(/^#(access_token=|[^\\].*\&access_token=)/,function(e){var f=c(e.path);this.app.setAccessToken(f.access_token);e.redirect(f.state.length==0?this.app.start_url:unescape(f.state));return false}).get(/^#(access_token=|[^\\].*\&access_token=)/,function(e){});this.before(/^#(error=|[^\\].*\&error=)/,function(e){var g=c(e.path);var f=g.error_description||"Access denined";e.trigger("oauth.denied",{code:g.error,message:f});return false}).get(/^#(error=|[^\\].*\&error=)/,function(e){})}})(jQuery);
